!-------------------------------------------------------------------------------
! (c) The copyright relating to this work is owned jointly by the Crown, 
! Met Office and NERC 2014. 
! However, it has been created with the help of the GungHo Consortium, 
! whose members are identified at https://puma.nerc.ac.uk/trac/GungHo/wiki
!-------------------------------------------------------------------------------
!
!-------------------------------------------------------------------------------
module assign_coordinate_kernel_mod_test
  implicit none 

contains

  @test
  subroutine test_of_assign_coordinate()
    use pFUnit_Mod
    use assign_coordinate_kernel_mod, only : assign_coordinate_code
    use constants_mod,                only : r_def
    
    implicit none

    real(kind=r_def) :: tol, one
    
    integer :: nlayers, ndf, nverts, i
    integer :: map(1)
    real(kind=r_def) :: x(1),y(1),z(1)
    real(kind=r_def) :: vertices_phys(3,8,1), vertices_comp(8,3), nodal_coord(3,1)

    nlayers = 1
    ndf     = 1
    nverts  = 8
    map(1)  = 1
    
    vertices_phys(1,:,1) = (/ 0.0_r_def, 2.0_r_def, 2.0_r_def, 0.0_r_def, 0.0_r_def, 2.0_r_def, 2.0_r_def, 0.0_r_def /)
    vertices_phys(2,:,1) = (/ 0.0_r_def, 0.0_r_def, 2.0_r_def, 2.0_r_def, 0.0_r_def, 0.0_r_def, 2.0_r_def, 2.0_r_def /)
    vertices_phys(3,:,1) = (/ 0.0_r_def, 0.0_r_def, 0.0_r_def, 0.0_r_def, 2.0_r_def, 2.0_r_def, 2.0_r_def, 2.0_r_def /)
    
    do i=1,nverts
      vertices_comp(i,1) =  vertices_phys(1,i,1)/2.0_r_def
      vertices_comp(i,2) =  vertices_phys(2,i,1)/2.0_r_def
      vertices_comp(i,3) =  vertices_phys(3,i,1)/2.0_r_def
    end do
    
    
    nodal_coord(:,1) = (/ 0.5_r_def, 0.5_r_def, 0.5_r_def /)
    
    call assign_coordinate_code(nlayers,ndf,nverts,map,x,y,z, &
                                  vertices_phys,nodal_coord,vertices_comp)
    
    
    one = 1.0_r_def

    @assertEqual( one, x(1), tol )  
    @assertEqual( one, y(1), tol ) 
    @assertEqual( one, z(1), tol ) 

  end subroutine test_of_assign_coordinate

end module assign_coordinate_kernel_mod_test
