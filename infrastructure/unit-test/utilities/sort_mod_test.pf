!-----------------------------------------------------------------------------
! (C) Crown copyright 2022 Met Office. All rights reserved.
! The file LICENCE, distributed with this code, contains details of the terms
! under which the code may be used.
!-----------------------------------------------------------------------------
!> Tests the results of the sorting algorithms
!>
!-------------------------------------------------------------------------------
module sort_mod_test

  use constants_mod, only : i_def
  use sort_mod, only      : bubble_sort

  use funit

  implicit none

  private
  public :: sort_test

  @TestCase
  type, extends(TestCase), public :: sort_test_type
    private
  contains
    procedure sort_test
  end type sort_test_type

contains

  @test
  subroutine sort_test( this )
    implicit none

    class(sort_test_type), intent(inout) :: this

    integer(kind=i_def) :: input(5) ! Data to be sorted
    integer(kind=i_def) :: indx(5)  ! index of data being sorted
    integer(kind=i_def) :: answer(5)! expected values
    integer(kind=i_def) :: order(5) ! expected index

    ! Data (and index) that will be sorted
    input(1:5) = (/8_i_def, 12_i_def, 0_i_def, 3_i_def, 8_i_def/)
    indx(1:5) = (/1_i_def, 2_i_def, 3_i_def, 4_i_def, 5_i_def/)
    ! Expected answers
    answer(1:5) = (/0_i_def, 3_i_def, 8_i_def, 8_i_def, 12_i_def/)
    order(1:5) = (/3_i_def, 4_i_def, 1_i_def, 5_i_def, 2_i_def/)

    ! Full sort with index
    call bubble_sort( 5_i_def, input, indx )

    @assertEqual( answer, input )
    @assertEqual( order, indx )

    ! Reset input data
    input(1:5) = (/8_i_def, 12_i_def, 0_i_def, 3_i_def, 8_i_def/)

    ! Sort without index
    call bubble_sort( 5_i_def, input )

    @assertEqual( answer, input )

  end subroutine sort_test

end module sort_mod_test
