!-----------------------------------------------------------------------------
! Copyright (c) 2017,  Met Office, on behalf of HMSO and Queen's Printer
! For further details please refer to the file LICENCE.original which you
! should have received as part of this distribution.
!-----------------------------------------------------------------------------
!
!-------------------------------------------------------------------------------
module quadrature_mod_test
  implicit none

contains

  @test
  subroutine test_quadrature()
    use pFUnit_Mod
    use quadrature_mod, only : quadrature_type, GAUSSIAN
    use constants_mod, only : r_def
    implicit none

    integer, parameter :: nqp_h=9, nqp_v=3

    real(kind=r_def)   :: epsilon
    integer            :: test_qr

    real(kind=r_def) :: xqp_v(nqp_v), xqp_h(nqp_h,2)
    real(kind=r_def) :: wqp_v(nqp_v), wqp_h(nqp_h)
    real(kind=r_def) :: test_xqp_v(nqp_v), test_xqp_h(nqp_h,2)
    real(kind=r_def) :: test_wqp_v(nqp_v), test_wqp_h(nqp_h)

    type(quadrature_type)  :: qr

    epsilon = 1.0e-14_r_def

    qr = quadrature_type(nqp_v, GAUSSIAN)

    test_xqp_v(:)   = [0.112701665379258_r_def, &
                       0.500000000000000_r_def, &
                       0.887298334620742_r_def]

    test_xqp_h(:,1) = [0.112701665379258_r_def, &
                       0.112701665379258_r_def, &
                       0.112701665379258_r_def, &
                       0.500000000000000_r_def, &
                       0.500000000000000_r_def, &
                       0.500000000000000_r_def, &
                       0.887298334620742_r_def, &
                       0.887298334620742_r_def, &
                       0.887298334620742_r_def]

    test_xqp_h(:,2) = [0.112701665379258_r_def, &
                       0.500000000000000_r_def, &
                       0.887298334620742_r_def, &
                       0.112701665379258_r_def, &
                       0.500000000000000_r_def, &
                       0.887298334620742_r_def, &
                       0.112701665379258_r_def, &
                       0.500000000000000_r_def, &
                       0.887298334620742_r_def]

    test_wqp_v(:) =   [0.277777777777776_r_def, &
                       0.444444444444444_r_def, &
                       0.277777777777776_r_def]

    test_wqp_h(:) =   [7.716049382715970E-002_r_def, &
                       0.123456790123456_r_def, &
                       7.716049382715970E-002_r_def, &
                       0.123456790123456_r_def, &
                       0.197530864197531_r_def, &
                       0.123456790123456_r_def, &
                       7.716049382715970E-002_r_def, &
                       0.123456790123456_r_def, &
                       7.716049382715970E-002_r_def]

    xqp_v = qr%get_xqp_v()
    @assertEqual( xqp_v, test_xqp_v, epsilon )

    xqp_h = qr%get_xqp_h()
    @assertEqual( xqp_h, test_xqp_h, epsilon )

    wqp_v = qr%get_wqp_v()
    @assertEqual( wqp_v, test_wqp_v, epsilon )

    wqp_h = qr%get_wqp_h()
    @assertEqual( wqp_h, test_wqp_h, epsilon )

  end subroutine test_quadrature

end module quadrature_mod_test
